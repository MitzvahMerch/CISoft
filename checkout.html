<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <script src="https://www.paypal.com/sdk/js?client-id=AZzLQop9vrKuZKKoH5kjjdUW5bti6eMFwBePvUDXA2lYYZG73hHo3LFKSULAJfg84qHWdbqbDsio8C4p"></script>
</head>
<body>
    <h1>Checkout Page</h1>
    <div id="priceDisplay">Total Price: Calculating...</div>
    <div id="paypal-button-container"></div>

    <script>
        let totalPrice = 0; // Variable to store the fetched price

        // Fetch the price from your Firebase Function or Firestore
        async function fetchPrice() {
            try {
                const response = await fetch('https://us-central1-mitzvahmerch-ac346.cloudfunctions.net/calculatePrice?sessionId=YOUR_SESSION_ID&quantity=10&sku=BC3001C1');
                const result = await response.json();

                if (result.price) {
                    totalPrice = result.price;
                    document.getElementById('priceDisplay').innerText = `Total Price: $${totalPrice}`;
                } else {
                    document.getElementById('priceDisplay').innerText = 'Could not calculate price. Please try again.';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('priceDisplay').innerText = 'There was an error calculating the price.';
            }
        }

        // Call the function to fetch price on page load
        fetchPrice();

        // Render the PayPal button and handle payment
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: totalPrice.toFixed(2) // Use the fetched price for PayPal
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('Transaction completed by ' + details.payer.name.given_name);
                });
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>
